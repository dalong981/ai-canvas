# v0.0.5 版本说明

> 本地文件保存功能（固定路径）

## 目标

点击"保存"后，画布内容直接保存到 `ai-canvas/data/主题名/` 目录，无需手动选择文件夹。

## 保存结构

```
/Users/wwbar/ai-canvas/
├── data/                          ← 新增：数据目录
│   ├── 习惯的力量/
│   │   ├── canvas.json            ← 完整画布数据（用于恢复）
│   │   └── content.md             ← 可读内容（用于 AI 分析）
│   └── 另一个主题/
│       ├── canvas.json
│       └── content.md
├── src/
├── server/                        ← 新增：后端服务
│   └── index.ts
└── ...
```

## 实现方式

把后端 API 集成到 Vite 开发服务器，不需要额外启动服务。

### 技术方案

1. 使用 Vite 插件在开发服务器中添加 API 路由
2. 前端调用 `POST /api/save` 和 `GET /api/open`
3. 后端直接写入/读取 `ai-canvas/data/` 目录

### API 设计

| 接口 | 方法 | 功能 |
|------|------|------|
| `/api/save` | POST | 保存画布（传入 name、json、markdown） |
| `/api/open/:name` | GET | 加载指定画布 |
| `/api/list` | GET | 列出所有已保存的画布 |

## 用户操作流程

### 保存
1. 点击"💾 保存"按钮
2. 输入画布名称（如"习惯的力量"）
3. 自动保存到 `ai-canvas/data/习惯的力量/`
4. 提示"保存成功"

### 打开
1. 点击"📂 打开"按钮
2. 显示已保存的画布列表
3. 选择一个，自动加载

## 文件说明

### canvas.json
完整的 tldraw 画布数据，包含：
- 所有元素（文字、图片、视频、箭头等）
- 位置坐标、大小、样式
- 连接关系

用途：重新加载画布时恢复完整状态

### content.md
人类可读的 Markdown 格式，包含：
- 所有文字内容
- 视频/文章链接
- 笔记内容

用途：
- 在 VS Code / Claude Code 中查看和编辑
- 喂给 AI 做分析

## 启动方式

不变，还是一个命令：

```bash
npm run dev
```

## 资源占用

- 内存增加：约 5-10MB（只是加了几个 API 路由）
- CPU：几乎为 0

## 改动文件

| 文件 | 变更 |
|------|------|
| vite.config.ts | 添加自定义插件处理 API 路由 |
| src/utils/storage.ts | 改为调用本地 API |
| src/App.tsx | 更新保存/打开逻辑 |
| data/ | 新建目录，存放画布数据 |

## 验收标准

1. ✅ 点保存 → 文件出现在 `ai-canvas/data/主题名/`
2. ✅ 包含 `canvas.json` 和 `content.md` 两个文件
3. ✅ 点打开 → 能看到已保存的画布列表
4. ✅ 选择后能恢复画布内容
5. ✅ 用 VS Code 能打开和编辑 `content.md`
